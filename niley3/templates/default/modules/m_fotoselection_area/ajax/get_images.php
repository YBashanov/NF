<?php$separator = "../../../../../";include "{$separator}ajax/_ScriptControl.php";include "{$separator}modules/includesToAjax.php";$whereAnd = "";//если выбрано из менюif ($_POST['id'] && $_POST['table']) {    $id = $regular->num($_POST['id']);    if ($id === false) {        echo '{"success":"false","message":"Недопустимое значение параметра id, table"}';        exit();    }    if ($_POST['table'] == "topics") {        $whereAnd .= " AND `topic`=".$id;    }    elseif ($_POST['table'] == "room_type") {        $whereAnd .= " AND `room_type`=".$id;    }}//для поискаif ($_POST['text']){    $text = $regular->sol_symbols_ext(urldecode($_POST['text']));    if ($text === false) {        echo '{"success":"false","message":"Недопустимое значение параметра text"}';        exit();    }    $whereAnd .= " AND (`name_ru` LIKE '%{$text}%' OR `name_en` LIKE '%{$text}%' OR `id`='{$text}')";}$page = 0;if (isset($_POST['page'])){    $page = $regular->num($_POST['page']);    if ($page === false) {        echo '{"success":"false","message":"Недопустимое значение параметра page"}';        exit();    }}//расчет limit$limit_inPage = 10;$limit_page = $limit_inPage * $page;$table = "{$config['prefix']}fotos";$where = "NOT(`deleted`)";$where .= $whereAnd;$where .= " ORDER BY `file`";$where .= " LIMIT {$limit_page}, {$limit_inPage}";$what = "id, file, file_ext, name_ru, name_en, width_height_d, vote_plus, vote_minus";$fotos = $db->select($table, $where, $what, 'id', 'resize.php');$echo = "";$length = 0;if ($fotos) {	foreach($fotos as $val) {        $text = "";		$height = 0;        if ($val['name_ru']) $text .= $val['name_ru'];        if (count($text) > 0) $text .= " / ";        if ($val['name_en']) $text .= $val['name_en'];		if ($val['width_height_d']) {			$a_height = explode("_", $val['width_height_d']);			$height = $a_height[1];		}		$echo .= '{"id":"'.$val['id'].'","original_file":"fotos/'.$val['file'].'","d_file":"fotos/d_'.$val['file'].'","file_ext":"'.$val['file_ext'].'","text":"'.$text.'","height":"'.$height.'","vote_plus":"'.$val['vote_plus'].'","vote_minus":"'.$val['vote_minus'].'"},';		$length++;	}    $echo = substr($echo, 0, strlen($echo)-1);}echo '{"success":"true","length":"'.$length.'", "data":['.$echo.']}';?>